name: ADQL Validation

on:
  push:
    branches: [ master, adql-validator ]
  pull_request:
    branches: [ master ]

jobs:

  build:

    runs-on: ubuntu-latest
    
    env:
      VALIDATOR_NAME  : adql-validator
      BUILD_PATH      : src/${VALIDATOR_NAME}
      VALIDATOR_SCRIPT: ${GITHUB_WORKSPACE}/${BUILD_PATH}/build/install/${VALIDATOR_NAME}/bin/${VALIDATOR_NAME}
      QUERIES_PATH    : ${GITHUB_WORKSPACE}/src/adql/ivoa

    steps:
    
    - uses: actions/checkout@v2
    
    - name: Set up JDK 8
      uses: actions/setup-java@v2
      with:
        java-version: '8'
        distribution: 'adopt'
    
    - name: Build the ADQL Validator
      uses: gradle/gradle-build-action@v2.0.1
      with:
        build-root-directory: ${BUILD_PATH}
        arguments           : installDist
    
    - name : Run ADQL validation queries
      run  : ${VALIDATOR_SCRIPT} -r -f markdown ${QUERIES_PATH}
      shell: bash
